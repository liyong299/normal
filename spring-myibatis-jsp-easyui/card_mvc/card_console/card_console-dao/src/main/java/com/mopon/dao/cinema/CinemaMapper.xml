<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mopon.dao.cinema.CinemaMapper" >
  <resultMap id="CinemaResultMap" type="com.mopon.entity.cinema.Cinema" >
    <id column="cinemano" property="code" />
    <result column="cinemaname" property="name" />
    <result column="province" property="province" />
    <result column="provinceno" property="provinceCode" />
    <result column="county" property="county" />
    <result column="countyno" property="countyCode" />
    <result column="city" property="city" />
    <result column="cityno" property="cityCode" />
    <association property="halls" column="cinemano" select="queryHallByCinemaCode"></association>
  </resultMap>

  <resultMap id="HallResultMap" type="com.mopon.entity.cinema.Hall" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="hallno" property="code" />
    <result column="hallname" property="name" />
  </resultMap>

  <sql id="selectCinema" >
		SELECT bc.cinemano,
		bc.cinemaname,
		bc.provinceno,
		bc.province,
		bc.cityno,
		bc.city,
		bc.countyno,
		bc.county,
		bc.status
		from base_cinema bc
  </sql>
  <sql id="queryHall">
	SELECT bh.id,
	    bh.hallno,
	    bh.hallname,
	    bh.seatcount,
	    bh.cinemano,
	    bh.seatmd5
	from base_hall bh
  </sql>
  <select id="queryCinemaByAreaCode" resultMap="CinemaResultMap" parameterType="com.mopon.entity.cinema.Cinema">
  	<include refid="selectCinema"/>
  	<where>
  		status = 1
  		<if test="provinceCode != null and provinceCode !='' ">
  			and provinceno = #{provinceCode}
  		</if>
  		<if test="cityCode != null and cityCode !='' ">
  			and cityno = #{cityCode}
  		</if>
  		<if test="countyCode != null and countyCode !='' ">
  			and countyno = #{countyCode}
  		</if>
  		<if test="name != null and name !='' ">
  			and cinemaname like CONCAT('%','${name}','%')
  		</if>
  	</where>
  </select>
  <select id="queryHallByCinemaCode" resultMap="HallResultMap" parameterType="String" >
   <include refid="queryHall"/>
   <where>
		bh.cinemano = #{code}
   </where>
  </select>

</mapper>