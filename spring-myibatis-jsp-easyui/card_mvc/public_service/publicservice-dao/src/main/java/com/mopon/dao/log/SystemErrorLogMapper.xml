<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mopon.dao.log.SystemErrorLogDao" >
<!-- 异常日志 -->
	<resultMap type="com.mopon.entity.log.SysExecptionLog" id="SystemErrorLogsResultMap">
		<id property="logID" column="LogID" />
		<result property="applicationName" column="ApplicationName" />
		<result property="funName" column="FunName" />
		<result property="expMsg" column="ExpMsg" />
		<result property="expStackTrace" column="ExpStackTrace" />
		<result property="recTimeShow" column="RecTime" />
	</resultMap>

	<sql id="fieldList" >
	   LogID,
	   ApplicationName,
	   FunName,
	   ExpMsg,
	   ExpStackTrace,
	   FROM_UNIXTIME( RecTime, '%Y-%m-%d %H:%i:%s' ) as RecTime
	</sql>
	<select id="queryPageList" parameterType="com.mopon.util.Page" resultMap="SystemErrorLogsResultMap">
		SELECT  
     	<include refid="fieldList"></include>
     	from log_SysExecptionLog
		<where>
			1=1
	    	<if test="params.sysExecptionLog.applicationName !=null  and params.sysExecptionLog.applicationName!=''">
	    	    and ApplicationName LIKE CONCAT("%",#{params.sysExecptionLog.applicationName},"%")
	    	</if>	    	
	    	<if test="params.sysExecptionLog.funName!=null  and params.sysExecptionLog.funName!=''">
	    	    and FunName LIKE CONCAT("%",#{params.sysExecptionLog.funName},"%")
	    	</if>	    	
	    	<if test="params.sysExecptionLog.expMsg !=null  and params.sysExecptionLog.expMsg!=''">
	    	    and ExpMsg LIKE  CONCAT("%",#{params.sysExecptionLog.expMsg},"%") 
	    	</if>
			<if test="params.sysExecptionLog.createDateBagin != null and params.sysExecptionLog.createDateBagin !='' " >
      			 and RecTime &gt;=  UNIX_TIMESTAMP(#{params.sysExecptionLog.createDateBagin})
		    </if>
		    <if test="params.sysExecptionLog.createDateEnd != null and params.sysExecptionLog.createDateEnd !='' " >
		      	 and RecTime &lt;=  UNIX_TIMESTAMP(#{params.sysExecptionLog.createDateEnd})
		    </if>
		</where>
		ORDER BY RecTime DESC
	</select>
	
	<select id="querySystemErroRrLogsById" parameterType="java.lang.String" resultMap="SystemErrorLogsResultMap">
	    SELECT  
     	<include refid="fieldList"></include>
     	from log_SysExecptionLog
	     WHERE 
	     LogID = #{id}
	</select>
	
	<insert id="insert" parameterType="com.mopon.entity.log.SysExecptionLog">
	 INSERT INTO  log_SysExecptionLog
     (
	     ApplicationName,
	     FunName,
	     ExpMsg,
	     ExpStackTrace,RecTime
     )
     VALUES
     (
	     #{applicationName},
	     #{funName},
	     #{expMsg},
	     #{expStackTrace},
	     #{recTime}
     )	
	</insert>
	
	</mapper>